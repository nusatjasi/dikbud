<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Tendik - Admin Sekolah</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .marquee {
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
    }
    .marquee span {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0%   { transform: translate(0, 0); }
      100% { transform: translate(-100%, 0); }
    }
    @keyframes rainbowBorder {
      0% { border-color: #3B82F6; }
      20% { border-color: #10B981; }
      40% { border-color: #F59E0B; }
      60% { border-color: #EF4444; }
      80% { border-color: #8B5CF6; }
      100% { border-color: #3B82F6; }
    }
    .staff-photo {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 50%;
    }
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .status-pns { background-color: #3B82F6; color: white; }
    .status-pppk { background-color: #10B981; color: white; }
    .status-honor { background-color: #F59E0B; color: white; }
    .countdown {
      font-weight: bold;
      color: #EF4444;
    }
    .sidebar-item {
      transition: all 0.3s ease;
    }
    .sidebar-item:hover {
      transform: translateX(5px);
    }
    .sidebar-subitem {
      transition: all 0.2s ease;
    }
    .sidebar-subitem:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: translateX(3px);
    }
    .rainbow-border {
      animation: rainbowBorder 8s infinite;
      border-width: 2px;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div id="app" class="flex h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-blue-800 text-white flex flex-col p-4 space-y-4 transition-all duration-300 relative">
      <div class="flex items-center justify-center gap-2 border-b border-blue-700 pb-4">
        <img src="logo.png" alt="Logo" class="w-10 h-10">
        <h1 class="text-xl font-bold">Admin Sekolah</h1>
      </div>
      <nav class="flex-1 space-y-2 mt-2">
        <div class="sidebar-item flex items-center gap-2 p-2 hover:bg-blue-700 rounded">
          <i class="fas fa-home w-5 h-5"></i>
          <a href="index.html" class="font-semibold">Beranda</a>
        </div>
        <div>
          <button onclick="toggleSubmenu('guruSub')" class="sidebar-item font-semibold w-full text-left flex items-center justify-between p-2 hover:bg-blue-700 rounded">
            <span class="flex items-center gap-2">
              <i class="fas fa-chalkboard-teacher w-5 h-5"></i>
              Guru & Tendik
            </span>
            <svg class="w-4 h-4 transform transition-transform rotate-180" id="icon-guruSub" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <ul id="guruSub" class="ml-8 space-y-1 mt-1">
            <li class="sidebar-subitem"><a href="guru.html" class="block p-2 hover:bg-blue-700 rounded">Data Guru</a></li>
            <li class="sidebar-subitem"><a href="tendik.html" class="block p-2 hover:bg-blue-700 rounded bg-blue-700">Data Tendik</a></li>
          </ul>
        </div>
        <div>
          <button onclick="toggleSubmenu('siswaSub')" class="sidebar-item font-semibold w-full text-left flex items-center justify-between p-2 hover:bg-blue-700 rounded">
            <span class="flex items-center gap-2">
              <i class="fas fa-user-graduate w-5 h-5"></i>
              Siswa
            </span>
            <svg class="w-4 h-4 transform transition-transform" id="icon-siswaSub" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <ul id="siswaSub" class="ml-8 space-y-1 mt-1 hidden">
            <li class="sidebar-subitem"><a href="kelas7.html" class="block p-2 hover:bg-blue-700 rounded">Kelas 7</a></li>
            <li class="sidebar-subitem"><a href="kelas8.html" class="block p-2 hover:bg-blue-700 rounded">Kelas 8</a></li>
            <li class="sidebar-subitem"><a href="kelas9.html" class="block p-2 hover:bg-blue-700 rounded">Kelas 9</a></li>
          </ul>
        </div>
        <div class="sidebar-item flex items-center gap-2 p-2 hover:bg-blue-700 rounded">
          <i class="fas fa-users w-5 h-5"></i>
          <a href="rombel.html" class="font-semibold">Rombel</a>
        </div>
        <div class="sidebar-item flex items-center gap-2 p-2 hover:bg-blue-700 rounded">
          <i class="fas fa-school w-5 h-5"></i>
          <a href="profil.html" class="font-semibold">Profil Sekolah</a>
        </div>
        <div class="sidebar-item flex items-center gap-2 p-2 hover:bg-blue-700 rounded">
          <i class="fas fa-info-circle w-5 h-5"></i>
          <a href="informasi.html" class="font-semibold">Informasi</a>
        </div>
        <div class="sidebar-item flex items-center gap-2 p-2 hover:bg-blue-700 rounded">
          <i class="fas fa-cog w-5 h-5"></i>
          <a href="pengaturan.html" class="font-semibold">Pengaturan</a>
        </div>
      </nav>
      <div class="mt-auto pt-4 border-t border-blue-700">
        <button onclick="logout()" class="sidebar-item w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded flex items-center justify-center gap-2">
          <i class="fas fa-sign-out-alt"></i> Keluar
        </button>
      </div>
      <footer class="text-xs text-center py-2 w-full text-white/50">
        <div class="w-full text-center">&copy; 2025 Hak Cipta Admin Sekolah</div>
      </footer>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Navbar -->
      <header class="flex items-center justify-between bg-white px-6 py-3 shadow">
        <div class="flex items-center gap-4">
          <button onclick="toggleSidebar()" class="text-blue-800 focus:outline-none">
            <i class="fas fa-bars text-xl"></i>
          </button>
          <img src="logo.png" alt="Logo Sekolah" class="w-8 h-8">
          <span class="text-lg font-bold text-blue-800">Data Tenaga Kependidikan</span>
        </div>
        <div class="flex items-center gap-6">
          <div id="jamDigital" class="text-blue-800 text-lg font-bold"></div>
          <a href="pesan.html" class="relative">
            <i class="fas fa-bell text-xl text-blue-800"></i>
            <span class="absolute -top-1 -right-1 inline-block w-3 h-3 bg-red-600 rounded-full"></span>
          </a>
        </div>
      </header>

      <!-- Running Text -->
      <div class="bg-blue-100 text-blue-800 text-sm px-4 py-2 marquee border-b-2 border-blue-200">
        <span>Manajemen Data Tenaga Kependidikan - Silakan tambah, edit, atau hapus data tendik</span>
      </div>

      <!-- Main Content -->
      <main class="flex-1 p-6 overflow-auto space-y-6">
        <!-- Action Buttons -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div class="flex flex-wrap items-center gap-2">
            <button onclick="showAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow">
              <i class="fas fa-plus"></i> Tambah Tendik
            </button>
            <button onclick="exportToPDF()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow">
              <i class="fas fa-file-pdf"></i> Download PDF
            </button>
            <button onclick="refreshData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow">
              <i class="fas fa-sync-alt"></i> Segarkan Data
            </button>
          </div>
          <div class="relative w-full md:w-auto">
            <input type="text" placeholder="Cari tendik..." class="border rounded-lg pl-10 pr-4 py-2 w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm" id="searchInput">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
        </div>

        <!-- Staff Table -->
        <div class="bg-white rounded-xl shadow overflow-hidden rainbow-border">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-blue-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Foto</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Nama Tendik</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">NIP</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Tempat/Tgl Lahir</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Jabatan</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Pangkat/Gol</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">TMT</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Usia Pensiun</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Tgl Pensiun</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Sisa Waktu</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-blue-800 uppercase tracking-wider">Aksi</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="staffTableBody">
                <!-- Data will be inserted here by JavaScript -->
              </tbody>
            </table>
          </div>
          <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="flex-1 flex justify-between sm:hidden">
              <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"> Previous </a>
              <a href="#" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"> Next </a>
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
              <div>
                <p class="text-sm text-gray-700">
                  Menampilkan <span class="font-medium">1</span> sampai <span class="font-medium">10</span> dari <span class="font-medium" id="totalStaff">--</span> tendik
                </p>
              </div>
              <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                  <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left"></i>
                  </a>
                  <a href="#" aria-current="page" class="z-10 bg-blue-50 border-blue-500 text-blue-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium"> 1 </a>
                  <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium"> 2 </a>
                  <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium"> 3 </a>
                  <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Next</span>
                    <i class="fas fa-chevron-right"></i>
                  </a>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Add/Edit Staff Modal -->
  <div id="staffModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white rainbow-border">
      <div class="flex justify-between items-center border-b pb-3">
        <h3 class="text-lg font-semibold text-blue-800" id="modalTitle">Tambah Data Tendik</h3>
        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="staffForm" class="mt-4 space-y-4">
        <input type="hidden" id="staffId">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700">Nama Lengkap *</label>
            <input type="text" id="name" name="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="nip" class="block text-sm font-medium text-gray-700">NIP</label>
            <input type="text" id="nip" name="nip" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="birthPlace" class="block text-sm font-medium text-gray-700">Tempat Lahir *</label>
            <input type="text" id="birthPlace" name="birthPlace" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="birthDate" class="block text-sm font-medium text-gray-700">Tanggal Lahir *</label>
            <input type="date" id="birthDate" name="birthDate" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" onchange="calculatePensionDate()">
          </div>
          <div>
            <label for="position" class="block text-sm font-medium text-gray-700">Jabatan *</label>
            <select id="position" name="position" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="">Pilih Jabatan</option>
              <option value="Kepala Tata Usaha">Kepala Tata Usaha</option>
              <option value="Staf Tata Usaha">Staf Tata Usaha</option>
              <option value="Laboran">Laboran</option>
              <option value="Pustakawan">Pustakawan</option>
              <option value="Teknisi">Teknisi</option>
              <option value="Petugas Keamanan">Petugas Keamanan</option>
              <option value="Petugas Kebersihan">Petugas Kebersihan</option>
              <option value="Lainnya">Lainnya</option>
            </select>
          </div>
          <div>
            <label for="rank" class="block text-sm font-medium text-gray-700">Pangkat *</label>
            <select id="rank" name="rank" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="">Pilih Pangkat</option>
              <option value="Juru Muda">Juru Muda</option>
              <option value="Juru Muda Tingkat I">Juru Muda Tingkat I</option>
              <option value="Juru">Juru</option>
              <option value="Juru Tingkat I">Juru Tingkat I</option>
              <option value="Pengatur Muda">Pengatur Muda</option>
              <option value="Pengatur Muda Tingkat I">Pengatur Muda Tingkat I</option>
              <option value="Pengatur">Pengatur</option>
              <option value="Pengatur Tingkat I">Pengatur Tingkat I</option>
              <option value="Penata Muda">Penata Muda</option>
              <option value="Penata Muda Tingkat I">Penata Muda Tingkat I</option>
              <option value="Penata">Penata</option>
              <option value="Penata Tingkat I">Penata Tingkat I</option>
              <option value="Pembina">Pembina</option>
              <option value="Pembina Tingkat I">Pembina Tingkat I</option>
              <option value="Pembina Utama Muda">Pembina Utama Muda</option>
              <option value="Pembina Utama Madya">Pembina Utama Madya</option>
              <option value="Pembina Utama">Pembina Utama</option>
              <option value="-">-</option>
            </select>
          </div>
          <div>
            <label for="group" class="block text-sm font-medium text-gray-700">Golongan *</label>
            <select id="group" name="group" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="">Pilih Golongan</option>
              <option value="I/a">I/a</option>
              <option value="I/b">I/b</option>
              <option value="I/c">I/c</option>
              <option value="I/d">I/d</option>
              <option value="II/a">II/a</option>
              <option value="II/b">II/b</option>
              <option value="II/c">II/c</option>
              <option value="II/d">II/d</option>
              <option value="III/a">III/a</option>
              <option value="III/b">III/b</option>
              <option value="III/c">III/c</option>
              <option value="III/d">III/d</option>
              <option value="IV/a">IV/a</option>
              <option value="IV/b">IV/b</option>
              <option value="IV/c">IV/c</option>
              <option value="IV/d">IV/d</option>
              <option value="IV/e">IV/e</option>
              <option value="-">-</option>
            </select>
          </div>
          <div>
            <label for="tmt" class="block text-sm font-medium text-gray-700">TMT *</label>
            <input type="date" id="tmt" name="tmt" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="status" class="block text-sm font-medium text-gray-700">Status Kepegawaian *</label>
            <select id="status" name="status" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="">Pilih Status</option>
              <option value="PNS">PNS</option>
              <option value="PPPK">PPPK</option>
              <option value="Honor Sekolah">Honor Sekolah</option>
              <option value="Honor Daerah">Honor Daerah</option>
              <option value="Tenaga Kontrak">Tenaga Kontrak</option>
            </select>
          </div>
          <div>
            <label for="pensionAge" class="block text-sm font-medium text-gray-700">Usia Pensiun *</label>
            <select id="pensionAge" name="pensionAge" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" onchange="calculatePensionDate()">
              <option value="">Pilih Usia Pensiun</option>
              <option value="58">58 Tahun</option>
              <option value="60">60 Tahun</option>
              <option value="-">-</option>
            </select>
          </div>
          <div>
            <label for="pensionDate" class="block text-sm font-medium text-gray-700">Tanggal Pensiun</label>
            <input type="date" id="pensionDate" name="pensionDate" readonly class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="gender" class="block text-sm font-medium text-gray-700">Jenis Kelamin *</label>
            <select id="gender" name="gender" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
              <option value="">Pilih Jenis Kelamin</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
          <div>
            <label for="photo" class="block text-sm font-medium text-gray-700">Foto</label>
            <input type="file" id="photo" name="photo" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
          </div>
        </div>
        <div class="flex justify-end space-x-3 pt-4 border-t">
          <button type="button" onclick="closeModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded">Batal</button>
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- View Staff Modal -->
  <div id="viewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white rainbow-border">
      <div class="flex justify-between items-center border-b pb-3">
        <h3 class="text-lg font-semibold text-blue-800">Detail Tendik</h3>
        <button onclick="closeViewModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mt-4 space-y-4">
        <div class="flex flex-col items-center">
          <img id="viewPhoto" src="https://via.placeholder.com/150" alt="Staff Photo" class="staff-photo w-24 h-24 mb-3">
          <h4 id="viewName" class="text-xl font-bold text-center"></h4>
          <p id="viewNip" class="text-gray-600 text-center"></p>
        </div>
        <div class="grid grid-cols-2 gap-4 border-t pt-4">
          <div>
            <p class="text-sm text-gray-500">Tempat/Tgl Lahir</p>
            <p id="viewBirth" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Jabatan</p>
            <p id="viewPosition" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Pangkat/Golongan</p>
            <p id="viewRankGroup" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">TMT</p>
            <p id="viewTmt" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Status Kepegawaian</p>
            <p id="viewStatus" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Usia Pensiun</p>
            <p id="viewPensionAge" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Tanggal Pensiun</p>
            <p id="viewPensionDate" class="font-medium"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Sisa Waktu</p>
            <p id="viewCountdown" class="font-medium countdown"></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Jenis Kelamin</p>
            <p id="viewGender" class="font-medium"></p>
          </div>
        </div>
        <div class="flex justify-end pt-4 border-t">
          <button onclick="closeViewModal()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;
    
    // Load data from localStorage or use sample data
    let staffs = JSON.parse(localStorage.getItem('staffs')) || [
      {
        id: 1,
        name: "Dewi Lestari, S.Pd",
        nip: "197803152000122001",
        birthPlace: "Jakarta",
        birthDate: "1978-03-15",
        position: "Kepala Tata Usaha",
        rank: "Penata Tk.I",
        group: "III/d",
        tmt: "2000-12-01",
        status: "PNS",
        pensionAge: 58,
        pensionDate: "2036-03-15",
        gender: "Perempuan",
        photo: "https://randomuser.me/api/portraits/women/2.jpg"
      },
      {
        id: 2,
        name: "Bambang Sutrisno",
        nip: "198004102005011003",
        birthPlace: "Bandung",
        birthDate: "1980-04-10",
        position: "Laboran",
        rank: "Penata Muda Tk.I",
        group: "III/b",
        tmt: "2005-01-10",
        status: "PPPK",
        pensionAge: 58,
        pensionDate: "2038-04-10",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/3.jpg"
      },
      {
        id: 3,
        name: "Siti Aminah",
        nip: "198510152010012004",
        birthPlace: "Surabaya",
        birthDate: "1985-10-15",
        position: "Petugas Kebersihan",
        rank: "-",
        group: "-",
        tmt: "2010-01-15",
        status: "Honor Sekolah",
        pensionAge: "-",
        pensionDate: "-",
        gender: "Perempuan",
        photo: "https://randomuser.me/api/portraits/women/3.jpg"
      }
    ];

    // Calculate pension date based on birth date and pension age
    function calculatePensionDate() {
      const birthDate = document.getElementById('birthDate').value;
      const pensionAge = document.getElementById('pensionAge').value;
      
      if (birthDate && pensionAge && pensionAge !== '-') {
        const birth = new Date(birthDate);
        const pensionYear = birth.getFullYear() + parseInt(pensionAge);
        const pensionDate = new Date(birth);
        pensionDate.setFullYear(pensionYear);
        
        // Format as YYYY-MM-DD
        const formattedDate = pensionDate.toISOString().split('T')[0];
        document.getElementById('pensionDate').value = formattedDate;
      } else {
        document.getElementById('pensionDate').value = '';
      }
    }

    // Calculate age based on birth date
    function calculateAge(birthDate) {
      if (!birthDate) return '-';
      
      const birth = new Date(birthDate);
      const today = new Date();
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      
      return age;
    }

    // Calculate days until pension
    function calculateDaysUntilPension(pensionDate) {
      if (!pensionDate || pensionDate === '-') return "-";
      
      const today = new Date();
      const pension = new Date(pensionDate);
      const diffTime = pension - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) return "Sudah pensiun";
      if (diffDays === 0) return "Hari ini";
      if (diffDays < 30) return `${diffDays} hari lagi`;
      
      const diffMonths = Math.floor(diffDays / 30);
      const remainingDays = diffDays % 30;
      
      if (diffMonths < 12) {
        return `${diffMonths} bulan ${remainingDays > 0 ? remainingDays + ' hari' : ''}`.trim();
      }
      
      const diffYears = Math.floor(diffMonths / 12);
      const remainingMonths = diffMonths % 12;
      
      return `${diffYears} tahun ${remainingMonths > 0 ? remainingMonths + ' bulan' : ''}`.trim();
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      updateStaffTable();
      updateTotalStaff();
      updateDashboardData();
      updateJamDigital();
      setupStaffSearch();
    });

    // Update staff table with data
    function updateStaffTable(filteredStaffs = null) {
      const tableBody = document.getElementById('staffTableBody');
      tableBody.innerHTML = '';

      const staffsToDisplay = filteredStaffs || staffs;

      staffsToDisplay.forEach(staff => {
        let statusClass = '';
        if (staff.status === 'PNS') statusClass = 'status-pns';
        else if (staff.status === 'PPPK') statusClass = 'status-pppk';
        else statusClass = 'status-honor';

        // Format dates
        const birthDate = staff.birthDate ? new Date(staff.birthDate).toLocaleDateString('id-ID') : '-';
        const tmtDate = staff.tmt ? new Date(staff.tmt).toLocaleDateString('id-ID') : '-';
        const pensionDate = staff.pensionDate ? new Date(staff.pensionDate).toLocaleDateString('id-ID') : '-';
        const countdown = calculateDaysUntilPension(staff.pensionDate);
        const currentAge = calculateAge(staff.birthDate);
        const pensionAgeDisplay = staff.pensionAge === '-' ? '-' : `${staff.pensionAge} (${currentAge}/${staff.pensionAge})`;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <img src="${staff.photo}" alt="${staff.name}" class="staff-photo">
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">${staff.name}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${staff.nip || '-'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${staff.birthPlace || '-'}, ${birthDate}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${staff.position}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${staff.rank || '-'}/${staff.group || '-'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${tmtDate}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="status-badge ${statusClass}">${staff.status}</span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${pensionAgeDisplay}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">${pensionDate}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm countdown">${countdown}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <button onclick="viewStaff(${staff.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Lihat">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="editStaff(${staff.id})" class="text-yellow-600 hover:text-yellow-900 mr-2" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="confirmDeleteStaff(${staff.id})" class="text-red-600 hover:text-red-900" title="Hapus">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Update total staff count
    function updateTotalStaff() {
      document.getElementById('totalStaff').textContent = staffs.length;
    }

    // Update dashboard data in localStorage
    function updateDashboardData() {
      // Save staff data
      localStorage.setItem('staffs', JSON.stringify(staffs));
      localStorage.setItem('staffCount', staffs.length);
      
      // Count staff by status
      const statusCounts = {
        PNS: staffs.filter(s => s.status === 'PNS').length,
        PPPK: staffs.filter(s => s.status === 'PPPK').length,
        'Honor Sekolah': staffs.filter(s => s.status === 'Honor Sekolah').length,
        'Honor Daerah': staffs.filter(s => s.status === 'Honor Daerah').length,
        'Tenaga Kontrak': staffs.filter(s => s.status === 'Tenaga Kontrak').length
      };
      
      localStorage.setItem('staffStatusData', JSON.stringify(statusCounts));
      
      // Update upcoming retirements (for index.html)
      const upcomingRetirements = staffs
        .filter(s => s.pensionDate && new Date(s.pensionDate) > new Date())
        .sort((a, b) => new Date(a.pensionDate) - new Date(b.pensionDate))
        .slice(0, 5)
        .map(s => ({
          name: s.name,
          position: s.position,
          pensionDate: s.pensionDate,
          daysLeft: calculateDaysUntilPension(s.pensionDate)
        }));
      
      localStorage.setItem('upcomingRetirements', JSON.stringify(upcomingRetirements));
    }

    // Refresh data
    function refreshData() {
      staffs = JSON.parse(localStorage.getItem('staffs')) || [];
      updateStaffTable();
      updateTotalStaff();
      Swal.fire({
        position: 'center',
        icon: 'success',
        title: 'Data telah diperbarui',
        showConfirmButton: false,
        timer: 1500
      });
    }

    // Modal functions
    function showAddModal() {
      document.getElementById('modalTitle').textContent = 'Tambah Data Tendik';
      document.getElementById('staffForm').reset();
      document.getElementById('staffId').value = '';
      document.getElementById('staffModal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('staffModal').classList.add('hidden');
    }

    function closeViewModal() {
      document.getElementById('viewModal').classList.add('hidden');
    }

    // View staff details
    function viewStaff(id) {
      const staff = staffs.find(s => s.id === id);
      if (staff) {
        // Format dates
        const birthDate = staff.birthDate ? new Date(staff.birthDate).toLocaleDateString('id-ID') : '-';
        const tmtDate = staff.tmt ? new Date(staff.tmt).toLocaleDateString('id-ID') : '-';
        const pensionDate = staff.pensionDate ? new Date(staff.pensionDate).toLocaleDateString('id-ID') : '-';
        const countdown = calculateDaysUntilPension(staff.pensionDate);
        const currentAge = calculateAge(staff.birthDate);
        const pensionAgeDisplay = staff.pensionAge === '-' ? '-' : `${staff.pensionAge} (${currentAge}/${staff.pensionAge})`;
        
        document.getElementById('viewPhoto').src = staff.photo;
        document.getElementById('viewName').textContent = staff.name;
        document.getElementById('viewNip').textContent = staff.nip ? `NIP: ${staff.nip}` : 'NIP: -';
        document.getElementById('viewBirth').textContent = `${staff.birthPlace || '-'}, ${birthDate}`;
        document.getElementById('viewPosition').textContent = staff.position;
        document.getElementById('viewRankGroup').textContent = `${staff.rank || '-'}/${staff.group || '-'}`;
        document.getElementById('viewTmt').textContent = tmtDate;
        document.getElementById('viewStatus').textContent = staff.status;
        document.getElementById('viewPensionAge').textContent = pensionAgeDisplay;
        document.getElementById('viewPensionDate').textContent = pensionDate;
        document.getElementById('viewCountdown').textContent = countdown;
        document.getElementById('viewGender').textContent = staff.gender;
        document.getElementById('viewModal').classList.remove('hidden');
      }
    }

    // Edit staff
    function editStaff(id) {
      const staff = staffs.find(s => s.id === id);
      if (staff) {
        document.getElementById('modalTitle').textContent = 'Edit Data Tendik';
        document.getElementById('staffId').value = staff.id;
        document.getElementById('name').value = staff.name;
        document.getElementById('nip').value = staff.nip;
        document.getElementById('birthPlace').value = staff.birthPlace;
        document.getElementById('birthDate').value = staff.birthDate;
        document.getElementById('position').value = staff.position;
        document.getElementById('rank').value = staff.rank;
        document.getElementById('group').value = staff.group;
        document.getElementById('tmt').value = staff.tmt;
        document.getElementById('status').value = staff.status;
        document.getElementById('pensionAge').value = staff.pensionAge;
        document.getElementById('pensionDate').value = staff.pensionDate;
        document.getElementById('gender').value = staff.gender;
        document.getElementById('staffModal').classList.remove('hidden');
      }
    }

    // Confirm delete staff
    function confirmDeleteStaff(id) {
      const staff = staffs.find(s => s.id === id);
      Swal.fire({
        title: 'Apakah Anda yakin?',
        html: `Anda akan menghapus data <strong>${staff.name}</strong>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, hapus!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          deleteStaff(id);
        }
      });
    }

    // Delete staff
    function deleteStaff(id) {
      staffs = staffs.filter(staff => staff.id !== id);
      localStorage.setItem('staffs', JSON.stringify(staffs));
      updateStaffTable();
      updateTotalStaff();
      updateDashboardData();
      
      Swal.fire(
        'Dihapus!',
        'Data tendik telah dihapus.',
        'success'
      );
    }

    // Handle form submission
    document.getElementById('staffForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const id = document.getElementById('staffId').value;
      const name = document.getElementById('name').value;
      const nip = document.getElementById('nip').value;
      const birthPlace = document.getElementById('birthPlace').value;
      const birthDate = document.getElementById('birthDate').value;
      const position = document.getElementById('position').value;
      const rank = document.getElementById('rank').value;
      const group = document.getElementById('group').value;
      const tmt = document.getElementById('tmt').value;
      const status = document.getElementById('status').value;
      const pensionAge = document.getElementById('pensionAge').value;
      const pensionDate = document.getElementById('pensionDate').value;
      const gender = document.getElementById('gender').value;
      
      const photoInput = document.getElementById('photo');
      let photo = id ? staffs.find(s => s.id == id)?.photo : 'https://via.placeholder.com/150';
      
      if (photoInput.files.length > 0) {
        photo = URL.createObjectURL(photoInput.files[0]);
      }
      
      if (id) {
        // Update existing staff
        const index = staffs.findIndex(s => s.id == id);
        staffs[index] = { 
          ...staffs[index],
          name, 
          nip, 
          birthPlace,
          birthDate,
          position, 
          rank,
          group,
          tmt,
          status, 
          pensionAge,
          pensionDate,
          gender, 
          photo 
        };
      } else {
        // Add new staff
        const newId = staffs.length > 0 ? Math.max(...staffs.map(s => s.id)) + 1 : 1;
        staffs.push({ 
          id: newId, 
          name, 
          nip, 
          birthPlace,
          birthDate,
          position, 
          rank,
          group,
          tmt,
          status, 
          pensionAge,
          pensionDate,
          gender, 
          photo 
        });
      }
      
      localStorage.setItem('staffs', JSON.stringify(staffs));
      updateStaffTable();
      updateTotalStaff();
      updateDashboardData();
      closeModal();
      
      Swal.fire(
        'Berhasil!',
        `Data tendik ${name} telah ${id ? 'diperbarui' : 'ditambahkan'}.`,
        'success'
      );
    });

    // Export to PDF
    function exportToPDF() {
      const doc = new jsPDF();
      const title = "DATA TENAGA KEPENDIDIKAN";
      const schoolName = "Nama Sekolah Anda";
      const date = new Date().toLocaleDateString('id-ID');
      
      // Add title and school info
      doc.setFontSize(16);
      doc.text(title, 105, 15, { align: 'center' });
      doc.setFontSize(12);
      doc.text(schoolName, 105, 22, { align: 'center' });
      doc.text(`Tanggal: ${date}`, 105, 29, { align: 'center' });
      
      // Prepare table data
      const headers = [["No", "Nama", "NIP", "Tempat/Tgl Lahir", "Jabatan", "Pangkat/Gol", "TMT", "Status", "Tgl Pensiun", "Sisa Waktu"]];
      const data = staffs.map((staff, index) => {
        const birthDate = staff.birthDate ? new Date(staff.birthDate).toLocaleDateString('id-ID') : '-';
        const tmtDate = staff.tmt ? new Date(staff.tmt).toLocaleDateString('id-ID') : '-';
        const pensionDate = staff.pensionDate ? new Date(staff.pensionDate).toLocaleDateString('id-ID') : '-';
        const countdown = calculateDaysUntilPension(staff.pensionDate);
        const currentAge = calculateAge(staff.birthDate);
        const pensionAgeDisplay = staff.pensionAge === '-' ? '-' : `${staff.pensionAge} (${currentAge}/${staff.pensionAge})`;
        
        return [
          index + 1,
          staff.name,
          staff.nip || '-',
          `${staff.birthPlace || '-'}, ${birthDate}`,
          staff.position,
          `${staff.rank || '-'}/${staff.group || '-'}`,
          tmtDate,
          staff.status,
          pensionDate,
          countdown
        ];
      });

      // Add table
      doc.autoTable({
        head: headers,
        body: data,
        startY: 35,
        styles: {
          cellPadding: 3,
          fontSize: 8,
          valign: 'middle',
          halign: 'left'
        },
        headStyles: {
          fillColor: [59, 130, 246],
          textColor: 255,
          fontStyle: 'bold'
        },
        alternateRowStyles: {
          fillColor: [241, 245, 249]
        }
      });

      doc.save(`data_tendik_${new Date().toISOString().slice(0,10)}.pdf`);
    }

    // Search functionality
    function setupStaffSearch() {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase();
          const filteredStaffs = staffs.filter(staff => 
            staff.name.toLowerCase().includes(searchTerm) || 
            (staff.nip && staff.nip.toLowerCase().includes(searchTerm)) ||
            staff.position.toLowerCase().includes(searchTerm) ||
            staff.status.toLowerCase().includes(searchTerm) ||
            (staff.birthPlace && staff.birthPlace.toLowerCase().includes(searchTerm)) ||
            (staff.rank && staff.rank.toLowerCase().includes(searchTerm)) ||
            (staff.group && staff.group.toLowerCase().includes(searchTerm))
          );
          updateStaffTable(filteredStaffs);
        });
      }
    }

    // Toggle sidebar
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('w-64');
      sidebar.classList.toggle('w-0');
      sidebar.classList.toggle('hidden');
    }

    // Toggle submenu
    function toggleSubmenu(id) {
      const submenu = document.getElementById(id);
      const icon = document.getElementById('icon-' + id);
      submenu.classList.toggle('hidden');
      icon.classList.toggle('rotate-180');
    }

    // Digital clock
    function updateJamDigital() {
      const jam = document.getElementById("jamDigital");
      const now = new Date();
      const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
      jam.textContent = now.toLocaleTimeString('id-ID', options);
    }
    setInterval(updateJamDigital, 1000);

    // Logout function
    function logout() {
      Swal.fire({
        title: 'Keluar dari sistem?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, keluar',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = 'login.html';
        }
      });
    }
  </script>
</body>
</html>